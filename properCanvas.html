<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>properCanvas</title>

    <script>
        var canvas, ctx, mouseX , mouseY;
        var bounceX = 400, bounceY = 50;
        var directionX = 1, directionY = 1;
        var playerbar = {
            positionX: 600,
            positionY: 500,
            height: 15,
            width: 120
        };
        var mousePositionX = 0;

        

        function bounceBall() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            draw();
            updatePlayerbar();

            var positionPlayerbarX = playerbar.positionX;
            var positionPlayerbarY = playerbar.positionY;
            var heightPlayerbar = playerbar.height;
            var widthPlayerbar = playerbar.width;
            var bouncyLeft = bounceX-10;
            var bouncyRight = bounceX+10;
            var bouncyTop = bounceY-10;
            var bouncyBottom = bounceY+10;
            var playerbarLeft = positionPlayerbarX;
            var playerbarRight = positionPlayerbarX + widthPlayerbar;
            var playerbarTop = positionPlayerbarY;
            var playerbarBottom = positionPlayerbarY + heightPlayerbar;
            var speed = 5;
            var speedTolerance = speed-1;

            if (bounceX >= canvas.width -10 || bounceX <= 10) directionX *= -1;
            if (bounceY >= canvas.height -10 || bounceY <= 10) directionY *= -1;

            if (bouncyBottom == playerbarTop || bouncyBottom > playerbarTop && bouncyBottom <= playerbarTop + speedTolerance){
                if(bouncyRight >= playerbarLeft && bouncyLeft <= playerbarRight){
                    directionX *= -1;
                    directionY *= -1;
                } 
            }
            if (bouncyTop == playerbarBottom || bouncyTop < playerbarBottom && bouncyTop >= playerbarBottom + speedTolerance){
                if(bouncyRight >= playerbarLeft && bouncyLeft <= playerbarRight){
                    directionX *= -1;
                    directionY *= -1;
                }
            }
            if (bouncyRight == playerbarLeft || bouncyRight > playerbarLeft && bouncyRight <= playerbarLeft + speedTolerance){
                if(bouncyTop <= playerbarBottom && bouncyBottom >= playerbarTop){
                    directionX *= -1;
                    directionY *= -1;
                }
            }
            if (bouncyLeft == playerbarRight || bouncyLeft < playerbarRight && bouncyLeft >= playerbarRight + speedTolerance){
                if(bouncyTop <= playerbarBottom && bouncyBottom >= playerbarTop){
                    directionX *= -1;
                    directionY *= -1;
                }
            }

            document.getElementById("bounceXdisplay").innerHTML = "bounceX: "+bounceX;
            document.getElementById("bounceYdisplay").innerHTML = "bounceY: "+bounceY;
            document.getElementById("bouncyLeft").innerHTML = "bouncyLeft: "+bouncyLeft;
            document.getElementById("bouncyRight").innerHTML = "bouncyRight: "+bouncyRight;
            document.getElementById("bouncyTop").innerHTML = "bouncyTop: "+bouncyTop;
            document.getElementById("bouncyBottom").innerHTML = "bouncyBottom: "+bouncyBottom;
            document.getElementById("playerbarLeftdisplay").innerHTML = "PBL: "+playerbarLeft;
            document.getElementById("playerbarRightdisplay").innerHTML = "PBR "+playerbarRight;
            document.getElementById("playerbarTopdisplay").innerHTML = "PBT: "+playerbarTop;
            document.getElementById("playerbarBottomdisplay").innerHTML = "PBB: "+playerbarBottom;

            bounceX +=speed * directionX;
            bounceY +=speed * directionY;

            ctx.beginPath();
            ctx.arc(bounceX, bounceY, 10, 0, 2* Math.PI);
            ctx.stroke();

            setTimeout(bounceBall, 40);
        }

        function draw() {
            //zeichnet den Hintergrund
        }

        function initPlayerbar(ev) {
            mousePositionX = ev.clientX;
            
        }

        function updatePlayerbar(){
            var positionPlayerbarX = playerbar.positionX;
            var positionPlayerbarY = playerbar.positionY;
            var heightPlayerbar = playerbar.height;
            var widthPlayerbar = playerbar.width;
            
            ctx.beginPath();
            ctx.fillRect(mousePositionX-canvas.offsetLeft, positionPlayerbarY, widthPlayerbar, heightPlayerbar);
            ctx.stroke();

            playerbar.positionX = mousePositionX - canvas.offsetLeft;
        }
        
        
        /*function drawMouse (ev) {
            ctx.fillStyle = "#00FF00";
            ctx.fillRect(ev.clientX-canvas.offsetLeft-50/2, ev.clientY-canvas.offsetTop-50/2, 50, 50);
        }
        document.addEventListener("mousedown", drawMouse, false);*/

        /*function DrawOnKey(ev) {
            var key_press = String.fromCharCode(ev.keyCode);
            var key_code = event.keyCode;

            if(key_press == "A") {
                //Zeiche Rechteck
                ctx.fillStyle = "#0000FF";
                ctx.fillRect(mouseX-25, mouseY-25, 50, 50);
            }
        }
        document.addEventListener("keydown", DrawOnKey, false); */
        function init() {
            canvas = document.getElementById("canvas");
            ctx = canvas.getContext("2d");
            canvas.style.border = "blue 1px solid";
            document.addEventListener("mousemove", initPlayerbar, false);
            bounceBall();
        }

        document.addEventListener("DOMContentLoaded", init, false);
        //window.onload = init
        console.log("Test");
        
    
    </script>
</head>

<body>
    <canvas id="canvas" width="800" height="600" style="margin-left: auto; margin-right: auto; margin-top: 5%; display: block">

    </canvas>

    <p id="bounceXdisplay">
        "BounceX: "
    </p>
    <p id="bounceYdisplay">
        "BounceY: "
    </p>
    <p id="bouncyLeft">
        "BouncyLeft: "
    </p>
    <p id="bouncyRight">
        "BouncyRight: "
    </p>
    <p id="bouncyTop">
        "BouncyTop: "
    </p>
    <p id="bouncyBottom">
        "BouncyBottom: "
    </p>
    <p id="playerbarLeftdisplay">
        "PBL: "
    </p>
    <p id="playerbarRightdisplay">
        "PBR: "
    </p>
    <p id="playerbarTopdisplay">
        "PBT: "
    </p>
    <p id="playerbarBottomdisplay">
        "PBB: "
    </p>

</body>

</html>